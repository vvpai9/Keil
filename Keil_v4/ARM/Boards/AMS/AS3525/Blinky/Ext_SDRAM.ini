/******************************************************************************/
/* Ext_SDRAM.INI: External SDRAM Initialization File                          */
/******************************************************************************/
// <<< Use Configuration Wizard in Context Menu >>>                           // 
/******************************************************************************/
/* This file is part of the uVision/ARM development tools.                    */
/* Copyright (c) 2005-2007 Keil Software. All rights reserved.                */
/* This software may only be used under the terms of a valid, current,        */
/* end user licence from KEIL for a compatible version of KEIL software       */
/* development tools. Nothing else gives you the right to use this software.  */
/******************************************************************************/


FUNC void Init (void) {

  // Setup clocks as written in Abstract.txt
  _WDWORD(0xC80F0008, 0x00000000);      // CGU_PLLASUP
  _WDWORD(0xC80F0028, 0x000000FF);      // CGU_COUNTA
  _WDWORD(0xC80F0000, 0x00002630);      // CGU_PLLA
  _sleep_(10);
  _WDWORD(0xC80F0010, 0x00000051);      // CGU_PROC
  _WDWORD(0xC80F0014, 0x0FFFFF0B);      // CGU_PERI
  _sleep_(1);

  // Setup SDRAM controller
  _WDWORD(0xC6030000, 0x00000001);      // MPMCControl - Enable SDRAM controller
  _WDWORD(0xC6030020, 0x00000180);      // MPMCDynamicControl (NOP)
  _WDWORD(0xC6030020, 0x00000100);      // MPMCDynamicControl (Precharge All)
  _WDWORD(0xC6030024, 0x00000017);      // MPMCDynamicRefresh

  _WDWORD(0xC6030008, 0x00000000);      // MPMCConfig - Set Little-endian mode
  _WDWORD(0xC6030028, 0x00000001);      // MPMCDynamicReadConfig
  _WDWORD(0xC6030030, 0x00000001);      // MPMCDynamicRP
  _WDWORD(0xC6030034, 0x00000003);      // MPMCDynamicRAS
  _WDWORD(0xC6030038, 0x00000006);      // MPMCDynamicSREX
  _WDWORD(0xC603003C, 0x00000000);      // MPMCDynamicAPR
  _WDWORD(0xC6030040, 0x00000004);      // MPMCDynamicDAL
  _WDWORD(0xC6030044, 0x00000001);      // MPMCDynamicWR
  _WDWORD(0xC6030048, 0x00000006);      // MPMCDynamicRC
  _WDWORD(0xC603004C, 0x00000006);      // MPMCDynamicRFC
  _WDWORD(0xC6030050, 0x00000006);      // MPMCDynamicXSR
  _WDWORD(0xC6030054, 0x00000001);      // MPMCDynamicRRD
  _WDWORD(0xC6030058, 0x00000001);      // MPMCDynamicMRD

  _WDWORD(0xC6030104, 0x00000202);      // MPMCDynamicRasCas0
  _WDWORD(0xC6030100, 0x00001488);      // MPMCDynamicConfig0
  _WDWORD(0xC6030020, 0x00000080);      // MPMCDynamicControl (Mode)
  _RDWORD(0x30008C00);                  // Load Mode register
  _RDWORD(0x30810000);                  // Load Extended Mode register
  _WDWORD(0xC6030020, 0x00000000);      // MPMCDynamicControl (Normal)

  _WDWORD(0xC6030100, 0x00081488);      // MPMCDynamicConfig0 - Enable buffer
}


Init();                                 // Initialize memory

LOAD Ext_SDRAM\Blinky.axf INCREMENTAL   // Download program

// <o> Program Entry Point
  PC = 0x30000000;

g, main                                 // Goto Main
