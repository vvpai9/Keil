<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>USB Device</title>
<title>USB Component: USB Device</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="drv.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylsheetf" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectlogo"><img alt="Logo" src="keilarm.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">USB Component
   &#160;<span id="projectnumber">Version 5.1</span>
   </div>
   <div id="projectbrief">MDK-Professional Middleware for USB Device and Host</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="DRVnav" class="tabs1">
    <ul class="tablist">
      <li id="GEN">   <a href="../../General/html/index.html"><span>General</span></a></li>
      <li id="FS">    <a href="../../FileSystem/html/index.html"><span>File System</span></a></li>
      <li id="GRA">   <a href="../../Graphic/html/index.html"><span>Graphic</span></a></li>
      <li id="NET">   <a href="../../Network/html/index.html"><span>Network</span></a></li>
      <li id="USB"    class="current">  	<a href="../../USB/html/index.html"><span>USB</span></a></li>
    </ul>
</div>
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Usage&#160;and&#160;Description</span></a></li>
      <li><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_u_s_b__device.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">USB Device </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#Creation_Steps">Create an USB Device Application</a><ul><li class="level2"><a href="#RTE_Software_Component_Selection">RTE Component Selection</a></li>
<li class="level2"><a href="#USB_Driver_Configuration">USB Driver and Controller</a></li>
<li class="level2"><a href="#USB_Device_Configuration">USB Device Configuration</a></li>
<li class="level2"><a href="#USB_Device_Class_Configuration">USB Device Class Configuration and USB Endpoint Settings</a></li>
<li class="level2"><a href="#User_Code_Implementation">User Code Implementation</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>This chapter describes the software structure of the USB Device Component and its use for creating applications. The USB Device Component simplifies the software development of microcontroller systems that interface to a USB Host.</p>
<p><b>Attributes of the USB Device Component:</b></p>
<ul>
<li>Supports <a class="el" href="_u_s_b__transfer__rates.html">USB 1.1 Full-Speed</a> and <a class="el" href="_u_s_b__transfer__rates.html">USB 2.0 High-Speed</a>.</li>
<li>Supports standard <a class="el" href="_u_s_b__classes.html">USB Classes</a> with multiple device class instances.</li>
<li>Supports composite devices. Combine USB Device Classes to create a <a class="el" href="dev_comp_tutorial.html">composite device</a>.</li>
<li>Supports multiple USB Devices on a single microcontroller with more than one USB Device controller.</li>
<li>Provides <a href="http://www.keil.com/support/man/docs/uv4/uv4_ca_sourcefiles.htm" class="el" target="_blank">User Code Templates</a> for implementing the USB device functionality.</li>
<li>Provides an user-friendly configuration file for each device class to implement <a class="el" href="_u_s_b__descriptors.html">USB Descriptors</a>.</li>
<li>Flexibly assigns <a class="el" href="_u_s_b__endpoints.html">USB Endpoints</a> to the microcontroller USB Device peripheral.</li>
<li>Provides <a class="el" href="_u_s_b__device__tutorial.html">USB Device Examples</a> to show the use of the software stack.</li>
</ul>
<p>For interfacing to an USB Host Computer, additional software may be required. Page <a class="el" href="usb_sw_utilities.html">Interface to an USB Host Computer</a> shows an example for such a software running on Windows PCs.</p>
<h2>RTE Components</h2>
<p>The picture shows the relationship between RTE Components and the microcontroller's USB Device peripheral (USB Controller). RTE Components provide configuration files and user code templates. <b>Configuration files</b> configure the RTE Components, hardware interfaces, memory resources and USB Device driver parameters. They can have an impact on multiple RTE Components (for example RTE_Device.h configures the USB Controller 0 <em>and</em> Driver_USBD0). <b>User code templates</b> implement the functionality of the USB Device Class.</p>
<p>The greyed area around the RTE Components USB Device 1 and Driver_USBD1, as well as USB Controller 1 means that are optional and can only be used if a microcontroller device has multiple USB controllers present. If this is the case, an USB Device Class can be connected to any of the USB Device Instances.</p>
<div class="image">
<img src="usb_device_blocks_config_files.png" alt="usb_device_blocks_config_files.png"/>
<div class="caption">
USB Device Structure</div></div>
<p> USB Device peripherals can have one or more of the following USB Device Classes:</p>
<ul>
<li><a class="el" href="_a_d_c.html">Audio Device class (ADC)</a> is used to exchange streaming audio data between the USB Host and the USB Device.</li>
<li><a class="el" href="_c_d_c.html">Communication Device Class (CDC)</a> provides virtual communication port functionality to the USB Host.</li>
<li><a class="el" href="_h_i_d.html">Human Interface Device (HID)</a> is typically used to implement a keyboard, joystick, or mouse. The HID class can be also used for exchanging simple data.</li>
<li><a class="el" href="_m_s_c.html">Mass Storage Class (MSC)</a> is used to connect various storage devices to an USB Host. MSC is not limited to an USB stick, but can be an SD card, internal or external Flash memory, and even a simple RAM disk.</li>
<li><a class="el" href="_custom_class.html">Custom Class</a> is used to implement either a standard or a vendor specific USB Device Class.</li>
</ul>
<p>Generic information about USB Device Classes can be found on the USB-IF's <a href="http://www.usb.org/developers/devclass_docs" class="el" target="_blank">Approved Class Specification Documents</a> page.</p>
<p>Multiple RTE Component instances can interface with more than one USB Controller or can implement multiple USB Device Classes. RTE Component instances are numbered. The number is appended to the RTE Component name, related configuration files, and user code templates. Each RTE Component has a separate configuration file. For example, for HID 0 and HID 1 the configuration files have the name <b>USB_Config_HID_0.h</b> and <b>USB_Config_HID_1.h</b>. </p>
<dl class="section note"><dt>Note</dt><dd>The default configuration settings are pre-configured for one instance of an USB Device or USB Device Class in a non-composite device peripheral. For other combinations the settings <em>need</em> to be edited to ensure proper operation. The <a class="el" href="dev_comp_tutorial.html">USB Composite Device</a> example shows how to implement and configure a composite devices</dd></dl>
<h1><a class="anchor" id="Creation_Steps"></a>
Create an USB Device Application</h1>
<p>The steps to create a microcontroller application that uses USB communication with an USB Device controller are:</p>
<ol type="1">
<li>Select <a class="el" href="_u_s_b__device.html#RTE_Software_Component_Selection">RTE Components</a> along with the USB Device Classes that are required for your application.</li>
<li><a class="el" href="_u_s_b__device.html#USB_Driver_Configuration">Enable and configure the USB Device Driver</a>.</li>
<li>Configure the <a class="el" href="_u_s_b__device.html#USB_Device_Configuration">USB Device</a> that connects the middleware to the microcontroller USB peripheral.</li>
<li>Configure <a class="el" href="_u_s_b__device.html#USB_Device_Class_Configuration">USB Device Class Configuration and USB Endpoint Settings</a> for each selected USB Device Class and instance.</li>
<li>Implement the <a class="el" href="_u_s_b__device.html#User_Code_Implementation">User Code</a> in the code templates that are provided for the USB Device Classes.</li>
</ol>
<p>For interfacing to an USB Host computer, standard USB Device Classes drivers can be used. This may require additional software development for the USB Host application. An exemplary application for interfacing to an USB HID Device is explained <a class="el" href="usb_sw_utilities.html#hid_client_app">here</a>.</p>
<h2><a class="anchor" id="RTE_Software_Component_Selection"></a>
RTE Component Selection</h2>
<p>Only a few steps are necessary to complete the RTE Component selection:</p>
<ol type="1">
<li>From the USB Component:<ul>
<li>Select <b>USB:CORE</b> that provides the basic functionality required for USB communication.</li>
<li>Set <b>USB:Device</b> to '1'. This creates one USB Device for communication with the USB Host.</li>
<li>Select the desired USB Classes (HID, MSC, CDC, ADC). For example, set <b>USB:Device:HID</b> to '1' to create a single HID Class Device. If you select more than one class or multiple instances of the same class, you will create a <b>Composite USB Device</b>.</li>
</ul>
</li>
<li>From the Drivers Component:<ul>
<li>Select an appropriate USB Device driver suitable for your application. Some microcontrollers may have specific drivers for USB Full-Speed and High-Speed whereas other microcontrollers may have a combined driver.</li>
</ul>
</li>
<li>From the Device Component:<ul>
<li>Additional device specific drivers may be required according to the validation output.</li>
</ul>
</li>
<li>From the CMSIS Component:<ul>
<li>Select the <b>CMSIS:CORE</b> to provide the core interface to the processor.</li>
<li>Select a suitable <b>CMSIS:RTOS</b> that is a required for the USB Component.</li>
</ul>
</li>
</ol>
<div class="image">
<img src="rteusbx.png" alt="rteusbx.png"/>
<div class="caption">
RTE Component Selection</div></div>
 <dl class="section note"><dt>Note</dt><dd><ul>
<li>Most microcontrollers have only one USB Controller implemented in hardware and only one driver <b>Driver_USBD0</b> is available. In this case, only one <b>USB:Device</b> can be selected to generate <b>USB Device 0</b>.</li>
<li>On a single <b>USB Device 0</b> an USB Composite Device may be implemented that combines multiple USB Device Classes.</li>
<li>When a microcontroller implements multiple USB Controllers an additional <b>USB Device 1</b> can be generated by setting <b>USB:Device</b> to '2'.</li>
</ul>
</dd></dl>
<h2><a class="anchor" id="USB_Driver_Configuration"></a>
USB Driver and Controller</h2>
<p>The USB Device Driver and the USB Controller of the microcontroller need to be correctly configured. In particular this means:</p>
<ul>
<li><p class="startli">The USB Device Driver selected under the Drivers Component is typically configured with the <b>RTE_Device.h</b> configuration file. While this file provides multiple options, it is typically sufficient to enable the USB Device peripheral related to this driver. Some microcontrollers may require settings that related to a physical layer interface <b></b>(PHY). The picture below shows two possible variants. Either, the USB PHY is integrated into the controller, or an external chip is used for providing the USB signal lines:</p>
<div class="image">
<img src="usb_phy.png" alt="usb_phy.png"/>
<div class="caption">
USB Controller and PHY Setups</div></div>
</li>
</ul>
<ul>
<li>The Endpoint settings in the <b>RTE_Device.h</b> are only used to reduce memory requirements and may be adjusted in a later step.</li>
<li>The USB Controller of the microcontroller typically needs specific clock settings. Consult the user's guide of the microcontroller to understand the requirements. Alternatively, you may copy the setup of an USB Device example (in case your hardware setup is similar to that of the chosen evaluation boards).</li>
</ul>
<h2><a class="anchor" id="USB_Device_Configuration"></a>
USB Device Configuration</h2>
<p>The configuration file <b>USBD_Config_<em>n</em>.c</b> is listed in the Project Windows under the Component USB and contains a number of important settings for the specific USB Device.</p>
<ul>
<li>The <b>Driver</b> <b>Number</b> is set according to the selected USB Controller. For single USB Device Controllers it will be '0'.</li>
<li><b>High-Speed</b> may be selected if supported by the USB Controller.</li>
<li>The <b>Vendor</b> <b>ID</b> (VID) needs to be set to a private VID. The default Vendor ID is owned by Keil and must not be used for actual products. Please visit <a href="http://www.usb.org/developers/vendor/" class="el" target="_blank">USB-IF</a> for more information on how to apply for a valid Vendor ID.</li>
<li>Every device needs an unique <b>Product</b> <b>ID</b>. Together with the <b>VID</b>, it is used by the Host computer's operating system to find a driver for your device.</li>
<li>The <b>Device Release Number</b> will be shown in Windows and Linux systems as “Firmware Revision”. The number will be interpreted as “binary coded decimal”, meaning that 0x0101 will be shown as firmware revision 1.01.</li>
<li>The <b>Manufacturer</b> and the <b>Product</b> <b>String</b> can be set to identify the USB Device in PC operating systems.</li>
</ul>
<h2><a class="anchor" id="USB_Device_Class_Configuration"></a>
USB Device Class Configuration and USB Endpoint Settings</h2>
<p>The USB Device Class Parameters and Endpoint Settings are configured in separate files for each USB Device Class and separately for each instance. The configuration files contain Device Class specific Endpoint Settings Numbers and are listed in the Project Window under the Component USB.</p>
<ul>
<li><b>USBD_Config_ADC_<em>n</em>.h</b> configuration for ADC Device Class.</li>
<li><b>USBD_Config_CDC_<em>n</em>.h</b> configuration for CDC Device Class.</li>
<li><b>USBD_Config_HID_<em>n</em>.h</b> configuration for HID Device Class.</li>
<li><b>USBD_Config_MSC_<em>n</em>.h</b> configuration for MSC Device Class.</li>
<li><b>USBD_Config_Class_<em>n</em>.h</b> configuration for Custom Class.</li>
</ul>
<p>Each <a class="el" href="_u_s_b__endpoints.html">USB Endpoint</a> can only be used once in the same USB Controller. It has to be made sure that the different USB Device Classes or multiple instances of the same USB Device Class use different Endpoints. The default configuration supports applications that use a single USB Device Class. The remaining parameters are specific settings that configure parameters for USB communication speed and the USB Device Class.</p>
<h2><a class="anchor" id="User_Code_Implementation"></a>
User Code Implementation</h2>
<p><a href="http://www.keil.com/support/man/docs/uv4/uv4_ca_sourcefiles.htm" class="el" target="_blank">User code template</a> files provide access to all functions that are required to communicate with the USB Device. The available functions are explained in the <a href="./modules.html" class="el">Reference</a> section of the USB Component. These routines can be adapted to the needs of the microcontroller application, in case more functionality is needed. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Feb 20 2014 15:12:48 for USB Component by ARM Ltd. All rights reserved.
	<!--
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 
	-->
	</li>
  </ul>
</div>
</body>
</html>
