<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Resource Requirements</title>
<title>USB Component: Resource Requirements</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="drv.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylsheetf" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectlogo"><img alt="Logo" src="keilarm.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">USB Component
   &#160;<span id="projectnumber">Version 5.1</span>
   </div>
   <div id="projectbrief">MDK-Professional Middleware for USB Device and Host</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="DRVnav" class="tabs1">
    <ul class="tablist">
      <li id="GEN">   <a href="../../General/html/index.html"><span>General</span></a></li>
      <li id="FS">    <a href="../../FileSystem/html/index.html"><span>File System</span></a></li>
      <li id="GRA">   <a href="../../Graphic/html/index.html"><span>Graphic</span></a></li>
      <li id="NET">   <a href="../../Network/html/index.html"><span>Network</span></a></li>
      <li id="USB"    class="current">  	<a href="../../USB/html/index.html"><span>USB</span></a></li>
    </ul>
</div>
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Usage&#160;and&#160;Description</span></a></li>
      <li><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('usb_resource_requirements.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Resource Requirements </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This section describes the resource requirements of the USB component. The actual requirements depend on the components used in the application and the configuration of these components.</p>
<h1><a class="anchor" id="usbd_res_req"></a>
USB Device Resource Requirements</h1>
<p>The following section documents the requirements for the USB Device Component.</p>
<h2><a class="anchor" id="usbd_rtos_req"></a>
CMSIS-RTOS Requirements</h2>
<p>The USB Device component uses CMSIS-RTOS threads. Each instance of a component starts its own threads, for example two HID instances start two threads with the name: <em>USBD_HID0_Thread</em>, <em>USBD_HID1_Thread</em>. The thread execution starts with <a class="el" href="group__usbd__core_functions.html#ga559583d2070ad06bd6b7b5be76c8cd2f">USBD_Initialize</a>. All threads execute with priority <b>osPriorityAboveNormal</b> on an user-provided stack.</p>
<p>The following table lists the components, number of threads executed along with thread name, the default stack size, and the configuration file with <b>OS Resource Settings</b> for stack size adjustments.</p>
<table class="doxtable">
<tr>
<th align="left">Component </th><th align="left">Threads / Thread Name </th><th align="center">Default Stack Size </th><th align="left">Configuration File</th></tr>
<tr>
<td align="left"><b>::USB:Device</b> </td><td align="left">1 / USBD<em>n</em>_CoreThread </td><td align="center">512 Bytes </td><td align="left">USBD_Config_<em>n</em>.c </td></tr>
<tr>
<td align="left"><b>::USB:Device:ADC</b> </td><td align="left">1 / USBD_ADC<em>n</em>_Thread </td><td align="center">512 Bytes </td><td align="left">USBD_Config_ADC_<em>n</em>.c </td></tr>
<tr>
<td align="left"><b>::USB:Device:CDC</b> </td><td align="left">2 / USBD_CDC<em>n</em>_Bulk_Thread, USBD_CDC<em>n</em>_Int_Thread </td><td align="center">512 Bytes </td><td align="left">USBD_Config_CDC_<em>n</em>.c </td></tr>
<tr>
<td align="left"><b>::USB:Device:Custom Class</b> </td><td align="left">1...15 / USBD_CustomClass<em>n</em>_EP<em>m</em>_Thread </td><td align="center">512 Bytes </td><td align="left">USBD_Config_CustomClass_<em>n</em>.c </td></tr>
<tr>
<td align="left"><b>::USB:Device:HID</b> </td><td align="left">1 / USBD_HID<em>n</em>_Thread </td><td align="center">512 Bytes </td><td align="left">USBD_Config_HID_<em>n</em>.c </td></tr>
<tr>
<td align="left"><b>::USB:Device:MSC</b> </td><td align="left">1 / USBD_MSC<em>n</em>_Thread </td><td align="center">512 Bytes </td><td align="left">USBD_Config_MSC_<em>n</em>.c </td></tr>
</table>
<p><em>n</em> is instance number, <em>m</em> is Endpoint number 1...15</p>
<dl class="section note"><dt>Note</dt><dd>For <b>::USB:Device:Custom Class</b> each endpoint executes a thread. The number of threads depends on the number of endpoints enabled in the configuration file USBD_Config_CustomClass_<em>n</em>.c.</dd></dl>
<p>For the USB Device component, the number of threads and thread stack size requirements are calculated as follows:</p>
<ul>
<li><b>Number of Threads</b>: add all threads of enabled components listed above.</li>
<li><b>Total stack size</b>: add the stack sizes of the related threads.</li>
</ul>
<p>With default stack size of 512 Bytes, the <b>Total stack size</b> is <b>Number of Threads</b> * 512 Bytes. When the default <b>OS Resource Settings</b> are modified, the changes need to be considered for the calculation of the <b>Total stack size</b>.</p>
<p><b>Examples</b> (with default stack size 512 Bytes):</p>
<ul>
<li>USB Device with HID uses 2 threads (1 for USB Device + 1 for HID) and 1024 Bytes stack.</li>
<li>Composite USB Device with HID <em>and</em> MSC uses 3 threads (1 for USB Device + 1 for HID + 1 for MSC) and 1536 Bytes stack.</li>
<li>USB Device with CDC uses 3 threads (1 for USB Device + 2 for CDC) and 1536 Bytes stack.</li>
<li>USB Device with Custom Class that has 3 endpoints uses 4 threads (1 for USB Device + 3 for Custom Class) and 2048 Bytes stack.</li>
</ul>
<p>The thread requirements need to be reflected in the CMSIS-RTOS configuration. Refer to the <a href="http://www.keil.com/cmsis/rtos" class="el" target="_blank">CMSIS-RTOS Reference</a> for further details.</p>
<p>For <a href="http://www.keil.com/pack/doc/cmsis_rtx/index.html" class="el" target="_blank">CMSIS-RTOS RTX</a>, the threads requirements are configured in the <code>RTX_Conf_CM.c</code> file located in the <b>CMSIS</b> components.</p>
<table class="doxtable">
<tr>
<th align="left">Option (under section Thread Configuration) </th><th align="left">Increase Value by</th></tr>
<tr>
<td align="left">Number of concurrent running threads </td><td align="left">+ <b>Number of Threads</b> </td></tr>
<tr>
<td align="left">Number of threads with user-provided stack size </td><td align="left">+ <b>Number of Threads</b> </td></tr>
<tr>
<td align="left">Total stack size [bytes] for threads with user-provided stack size</td><td align="left">+ <b>Total stack size</b> </td></tr>
</table>
<h2>System Configuration</h2>
<p>The <b>::USB:Device:HID</b> component requires <b>User Timers</b> to be selected. The Timer Thread Stack is commonly used by all threads working with User Timers. Depending on the application and the further usage of the timers, the <b>Timer Thread stack size</b> needs to be increased accordingly.</p>
<h2><a class="anchor" id="usbd_mem_req"></a>
Stack Requirements</h2>
<p>The USB Device Core is called by interrupt service routines (ISR) from the USB Device Driver. The stack requirements for the ISR are typically less than 512 Bytes. The total stack space required for ISR depends on the interrupt nesting and therefore on the priority settings of these ISR. The stack requirements for ISR is configured in the startup_<em>device</em>.s file located in the <b>Device</b> components.</p>
<table class="doxtable">
<tr>
<th align="left">Option (under section Stack Configuration) </th><th align="left">Increase Value by</th></tr>
<tr>
<td align="left">Stack Size (in Bytes) </td><td align="left">+ 512 for USB Device Driver </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>When using a CMSIS-RTOS, the Stack Size in the startup_<em>device</em>.s file configures only the stack space that is used by exception and interrupt service routines. The stack size requirements depend on the maximum nesting of exception and ISR execution and therefore on the priority settings of the various interrupt and exception sources.</dd></dl>
<p>User code that calls API functions of the USB Device Component should have a mimimum of 512 Bytes of stack space available. Since API functions are frequently called from threads, the thread stack size should be at least 512 Bytes.</p>
<h2><a class="anchor" id="usbd_spec_mem_req"></a>
Memory Requirements</h2>
<p>The following table shows the memory requirements for read-only (Flash) and read-write (RAM) memory. These numbers may be used to estimate the total size requirements of the application, but the actually numbers depend on compiler optimizations and target processor and may be therefore slightly different.</p>
<table class="doxtable">
<tr>
<th align="left">Component </th><th align="center">RO Memory [Bytes] </th><th align="left">RW Memory (Data) [Bytes]</th></tr>
<tr>
<td align="left"><b>::USB:Core</b> </td><td align="center">5.0 k </td><td align="left">&lt; 200 </td></tr>
<tr>
<td align="left"><b>::USB:Device:ADC</b> </td><td align="center">1.2 k </td><td align="left">&lt; 40 + <em>Subframe Size</em> (configured in USBD_Config_ADC_<em>n</em>.h) </td></tr>
<tr>
<td align="left"><b>::USB:Device:HID</b> </td><td align="center">2.6 k </td><td align="left">&lt; 70 + <em>Report Sizes</em> (configured in USBD_Config_HID_<em>n</em>.h) </td></tr>
<tr>
<td align="left"><b>::USB:Device:MSC</b> </td><td align="center">4.0 k </td><td align="left">96 + <em>Bulk Buffer Size</em> (configured in the USBD_Config_MSC_<em>n</em>.h) </td></tr>
<tr>
<td align="left"><b>::USB:Device:CDC</b> </td><td align="center">2.1 k </td><td align="left">&lt; 40 + <em>Send/Receive Buffer Size</em> (configured in the USBD_Config_CDC_<em>n</em>.h) </td></tr>
<tr>
<td align="left"><b>::USB:Device:Custom Class</b> </td><td align="center">2.4 k </td><td align="left">&lt; 30 </td></tr>
<tr>
<td align="left"><b>USB Device Driver</b> </td><td align="center">1 .. 4 k </td><td align="left">0.5 .. 4 k </td></tr>
</table>
<h1><a class="anchor" id="usbh_res_req"></a>
USB Host Resource Requirements</h1>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>make this similar to USB Device section above</dd></dl>
<h2><a class="anchor" id="usbh_mem_req"></a>
Stack/Heap Requirements</h2>
<p>The following requirements can be changed in the <code>startup_<em>device</em></code>.s file (below the <b>Device</b> component class).</p>
<table class="doxtable">
<tr>
<th>Type </th><th>Size </th><th>Description</th></tr>
<tr>
<td>Stack Size (in Bytes)</td><td>min. 6KB </td><td>Depends on functionality used </td></tr>
<tr>
<td>Heap Size (in Bytes) </td><td>min. 334 Bytes </td><td></td></tr>
</table>
<h2><a class="anchor" id="usbh_spec_mem_req"></a>
Special Memory Requirements</h2>
<p>State your requirements here.</p>
<h2><a class="anchor" id="usbh_rtos_req"></a>
CMSIS-RTOS Requirements</h2>
<p>The component uses CMSIS-RTOS functionality and defines the following threads.</p>
<p>For <a href="http://www.keil.com/pack/doc/cmsis_rtx/index.html" class="el" target="_blank">CMSIS-RTOS RTX</a>, the following requirements can be changed in the <code>RTX_Conf_CM.c</code> file (below the <b>CMSIS</b> component class). For corresponding settings, please refer to the user's guide of your selected RTOS.</p>
<table class="doxtable">
<tr>
<th align="left">Option </th><th>Value </th><th>Note</th></tr>
<tr>
<td align="left">Number of concurrent running threads </td><td></td><td></td></tr>
<tr>
<td align="left">Default Thread stack size [bytes] </td><td></td><td></td></tr>
<tr>
<td align="left">Main Thread stack size [bytes] </td><td></td><td></td></tr>
<tr>
<td align="left">Number of threads with user-provided stack size </td><td></td><td></td></tr>
<tr>
<td align="left">Total stack size [bytes] for threads with user-provided stack size</td><td></td><td></td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Feb 20 2014 15:12:50 for USB Component by ARM Ltd. All rights reserved.
	<!--
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 
	-->
	</li>
  </ul>
</div>
</body>
</html>
