<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>HID: Human Interface Class Functions</title>
<title>USB Component: HID: Human Interface Class Functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="drv.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylsheetf" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectlogo"><img alt="Logo" src="keilarm.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">USB Component
   &#160;<span id="projectnumber">Version 5.1</span>
   </div>
   <div id="projectbrief">MDK-Professional Middleware for USB Device and Host</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="DRVnav" class="tabs1">
    <ul class="tablist">
      <li id="GEN">   <a href="../../General/html/index.html"><span>General</span></a></li>
      <li id="FS">    <a href="../../FileSystem/html/index.html"><span>File System</span></a></li>
      <li id="GRA">   <a href="../../Graphic/html/index.html"><span>Graphic</span></a></li>
      <li id="NET">   <a href="../../Network/html/index.html"><span>Network</span></a></li>
      <li id="USB"    class="current">  	<a href="../../USB/html/index.html"><span>USB</span></a></li>
    </ul>
</div>
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Usage&#160;and&#160;Description</span></a></li>
      <li><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__usbd__hid_functions.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">HID: Human Interface Class Functions</div>  </div>
<div class="ingroups"><a class="el" href="group__usbd___dev_class_functions.html">Device Class Functions</a></div></div><!--header-->
<div class="contents">

<p>Implement application specific behaviour of a Human Interface Device (HID) Class.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga2c21f6f5bbe3b1fb832bbd7a1615f477"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usbd__hid_functions.html#ga2c21f6f5bbe3b1fb832bbd7a1615f477">USBD_HIDn_Initialize</a> (void)</td></tr>
<tr class="memdesc:ga2c21f6f5bbe3b1fb832bbd7a1615f477"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called during <a class="el" href="group__usbd__core_functions.html#ga559583d2070ad06bd6b7b5be76c8cd2f">USBD_Initialize</a> to initialize the USB HID class Device.  <a href="#ga2c21f6f5bbe3b1fb832bbd7a1615f477"></a><br/></td></tr>
<tr class="separator:ga2c21f6f5bbe3b1fb832bbd7a1615f477"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5ff95f579fd90e3c75f90c0c8d2b2968"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usbd__hid_functions.html#ga5ff95f579fd90e3c75f90c0c8d2b2968">USBD_HIDn_Uninitialize</a> (void)</td></tr>
<tr class="memdesc:ga5ff95f579fd90e3c75f90c0c8d2b2968"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called during <a class="el" href="group__usbd__core_functions.html#ga462720e29daee5b88825566f313ac04e">USBD_Uninitialize</a> to un-initialize the USB HID class Device.  <a href="#ga5ff95f579fd90e3c75f90c0c8d2b2968"></a><br/></td></tr>
<tr class="separator:ga5ff95f579fd90e3c75f90c0c8d2b2968"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaed8b507a9ce1bf958fbcae55ee0b91bf"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usbd__hid_functions.html#gaed8b507a9ce1bf958fbcae55ee0b91bf">USBD_HIDn_GetReport</a> (uint8_t rtype, uint8_t req, uint8_t rid, uint8_t *buf)</td></tr>
<tr class="memdesc:gaed8b507a9ce1bf958fbcae55ee0b91bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare HID Report data to send.  <a href="#gaed8b507a9ce1bf958fbcae55ee0b91bf"></a><br/></td></tr>
<tr class="separator:gaed8b507a9ce1bf958fbcae55ee0b91bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab7d101077f2018ca8a24da7dffce434f"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usbd__hid_functions.html#gab7d101077f2018ca8a24da7dffce434f">USBD_HIDn_SetReport</a> (uint8_t rtype, uint8_t req, uint8_t rid, const uint8_t *buf, int32_t len)</td></tr>
<tr class="memdesc:gab7d101077f2018ca8a24da7dffce434f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Process received HID Report data.  <a href="#gab7d101077f2018ca8a24da7dffce434f"></a><br/></td></tr>
<tr class="separator:gab7d101077f2018ca8a24da7dffce434f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafc3b0d68600cfbb390d1fa9b0ec8dac8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__status__error__codes__usb.html#gaa48e102b9b2600828158b5319c3386af">usbStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usbd__hid_functions.html#gafc3b0d68600cfbb390d1fa9b0ec8dac8">USBD_HID_GetReportTrigger</a> (int8_t instance, uint8_t rid, const uint8_t *buf, int32_t len)</td></tr>
<tr class="memdesc:gafc3b0d68600cfbb390d1fa9b0ec8dac8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Asynchronously prepare HID Report data to send.  <a href="#gafc3b0d68600cfbb390d1fa9b0ec8dac8"></a><br/></td></tr>
<tr class="separator:gafc3b0d68600cfbb390d1fa9b0ec8dac8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Description</h2>
<p>Implement application specific behaviour of a Human Interface Device (HID) Class. </p>
<p>The HID class in the USB Component is used for data exchange. It implements a vendor defined HID class with Usage Page ID=0xFF00.</p>
<p>Refer to:</p>
<ul>
<li><a class="el" href="_h_i_d.html">HID: Human Interface Device Class</a> for an overview of the HID class.</li>
<li><a class="el" href="dev_hid_tutorial.html">USB Device HID</a> for example projects that use the HID class.</li>
</ul>
<p>The USB Component allows multiple instances of the HID class. This feature is used to create USB Composite Devices. Each HID class instance has a separate files and interface functions:</p>
<ul>
<li>A configuration file <b>USBD_Config_HID_<em>n</em>.h</b>.</li>
<li>An application specific user source code file which may be implemented with the <a href="http://www.keil.com/support/man/docs/uv4/uv4_ca_sourcefiles.htm" class="el" target="_blank">user code template</a> <b>USBD_User_HID_<em>n</em>.h</b>.</li>
<li>Functions that start with the prefix <b>USBD_HIDn_</b> are available for each instance of a HID class.</li>
</ul>
<p>This documentation uses <em>n</em> as a placeholder for the instance number <em>0</em> - <em>3</em>. Most applications only require one instance of a HID class. For the first HID class instance the instance number is 0:</p>
<ul>
<li><b>USBD_Config_HID_0.h</b></li>
<li><b>USBD_User_HID_0.c</b></li>
<li>The function prefix is <b>USBD_HID0_</b></li>
</ul>
<p>To <a class="el" href="_u_s_b__device.html#Creation_Steps">create an USB Device</a> with a HID class:</p>
<ul>
<li>Set the required number for USB:Device:HID class instances during the <a class="el" href="_u_s_b__device.html#RTE_Software_Component_Selection">RTE Component Selection</a>.</li>
<li>Add the related <a href="http://www.keil.com/support/man/docs/uv4/uv4_ca_sourcefiles.htm" class="el" target="_blank">user code template</a> file.</li>
<li>Implement the application specific behaviour in <b>USBD_User_HID_<em>n</em>.c</b>.</li>
<li>Set the parameters in the configuration file <b>USBD_Config_HID_<em>n</em>.h</b>.</li>
</ul>
<p><a class="anchor" id="usbd_config_hid_n_h"></a><b>Configuration File USBD_Config_HID_<em>n</em>.h</b></p>
<p>The configuration file <b>USBD_Config_HID_<em>n</em>.h</b> defines:</p>
<ul>
<li>The assignment of the HID class to the USB Device instance.</li>
<li><a class="el" href="_u_s_b__endpoints.html">USB Endpoint</a> assignments for the HID class with parameters for Full/Low-speed and High-speed communication.</li>
<li>Class Settings for the Interface Descriptor.</li>
</ul>
<p>These settings are used to create the <a class="el" href="_u_s_b__interface__descriptor.html">Interface Descriptor</a> and <a class="el" href="_u_s_b__endpoint__descriptor.html">Endpoint Descriptor</a> of the related USB Device Class. It is important that the settings match the application specific behaviour in the related C source file USBD_User_HID_<em>n</em>.c.</p>
<p><b>Software Structure</b></p>
<p>The handling for the HID class endpoint events is implemented in USBD_HID_Thread which is started by <a class="el" href="group__usbd__core_functions.html#ga559583d2070ad06bd6b7b5be76c8cd2f">USBD_Initialize</a>. Each instance of a HID class runs an instance of USBD_HID_Thread which calls the data exchange functions <a class="el" href="group__usbd__hid_functions.html#gaed8b507a9ce1bf958fbcae55ee0b91bf">USBD_HIDn_GetReport</a> and <a class="el" href="group__usbd__hid_functions.html#gab7d101077f2018ca8a24da7dffce434f">USBD_HIDn_SetReport</a>.</p>
<p><a class="el" href="group__usbd__hid_functions.html#gafc3b0d68600cfbb390d1fa9b0ec8dac8">USBD_HID_GetReportTrigger</a> may be called from any user thread to send asynchronous data reports to the USB Host. <a class="el" href="group__usbd__hid_functions.html#gafc3b0d68600cfbb390d1fa9b0ec8dac8">USBD_HID_GetReportTrigger</a> cannot be called from interrupt service routines (ISR) as it may wait for previous data to be sent.</p>
<p>The HID class uses a CMSIS-RTOS osTimer set to a 4ms interval to handle polling reports. The polling timing is defined with <a class="el" href="_u_s_b__endpoint__descriptor.html">Endpoint Descriptor</a>. For more information refer to "Set_Idle Request" in <a href="http://www.usb.org/developers/devclass_docs/HID1_11.pdf" class="el" target="_blank">HID1_11.pdf</a> which is provided by USB Implementers Forum (USB-IF).</p>
<div align="center">
<img src="msc_inline_mscgraph_2.png" alt="msc_inline_mscgraph_2" border="0" usemap="#msc_inline_mscgraph_2.map"/>
<map name="msc_inline_mscgraph_2.map" id="msc_inline_mscgraph_2.map"><area href="group__usbd__core_functions.html#ga559583d2070ad06bd6b7b5be76c8cd2f" shape="rect" coords="31,78,120,91" alt=""/>
<area href="group__usbd__core_functions.html#gae8cb53f9288fdf288ea368b63816b60d" shape="rect" coords="40,129,111,142" alt=""/>
<area href="group__usbd__hid_functions.html#gaed8b507a9ce1bf958fbcae55ee0b91bf" shape="rect" coords="319,199,432,212" alt=""/>
<area href="group__usbd__hid_functions.html#gab7d101077f2018ca8a24da7dffce434f" shape="rect" coords="319,231,432,244" alt=""/>
<area href="group__usbd__hid_functions.html#gafc3b0d68600cfbb390d1fa9b0ec8dac8" shape="rect" coords="466,256,585,269" alt=""/>
<area href="group__usbd__hid_functions.html#gafc3b0d68600cfbb390d1fa9b0ec8dac8" shape="rect" coords="508,269,543,282" alt=""/>
<area href="group__usbd__core_functions.html#ga7580821317f14bfe4f052beca2f90b9b" shape="rect" coords="31,314,120,327" alt=""/>
<area href="group__usbd__core_functions.html#ga462720e29daee5b88825566f313ac04e" shape="rect" coords="25,365,126,378" alt=""/>
</map>
</div>
<h2>Code Example</h2>
<p>The following source code is part of the <a href="http://www.keil.com/support/man/docs/uv4/uv4_ca_sourcefiles.htm" target="_blank">user code template</a> file. The application specific behaviour may be implemented using this code template.</p>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;rl_usbd.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;usb_hid.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Called during USBD_Initialize to initialize the USB Device class.</span></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__usbd__hid_functions.html#ga2c21f6f5bbe3b1fb832bbd7a1615f477" title="Called during USBD_Initialize to initialize the USB HID class Device.">USBD_HIDn_Initialize</a> (<span class="keywordtype">void</span>) {</div>
<div class="line">  <span class="comment">// ToDo: add code for initialization</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Called during USBD_Uninitialize to de-initialize the USB Device class.</span></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__usbd__hid_functions.html#ga5ff95f579fd90e3c75f90c0c8d2b2968" title="Called during USBD_Uninitialize to un-initialize the USB HID class Device.">USBD_HIDn_Uninitialize</a> (<span class="keywordtype">void</span>) {</div>
<div class="line">  <span class="comment">// ToDo: add code for de-initialization</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// \brief Prepare HID Report data to send.</span></div>
<div class="line"><span class="comment">// \param[in]   rtype   report type:</span></div>
<div class="line"><span class="comment">//                - HID_REPORT_INPUT           = input report requested</span></div>
<div class="line"><span class="comment">//                - HID_REPORT_FEATURE         = feature report requested</span></div>
<div class="line"><span class="comment">// \param[in]   req     request type:</span></div>
<div class="line"><span class="comment">//                - USBD_HID_REQ_EP_CTRL       = control endpoint request</span></div>
<div class="line"><span class="comment">//                - USBD_HID_REQ_PERIOD_UPDATE = idle period expiration request</span></div>
<div class="line"><span class="comment">//                - USBD_HID_REQ_EP_INT        = previously sent report on interrupt endpoint request</span></div>
<div class="line"><span class="comment">// \param[in]   rid     report ID (0 if only one report exists).</span></div>
<div class="line"><span class="comment">// \param[out]  buf     buffer containing report data to send.</span></div>
<div class="line"><span class="comment">// \return              number of report data bytes prepared to send or invalid report requested.</span></div>
<div class="line"><span class="comment">//              - value &gt;= 0: number of report data bytes prepared to send</span></div>
<div class="line"><span class="comment">//              - value = -1: invalid report requested</span></div>
<div class="line">int32_t <a class="code" href="group__usbd__hid_functions.html#gaed8b507a9ce1bf958fbcae55ee0b91bf" title="Prepare HID Report data to send.">USBD_HIDn_GetReport</a> (uint8_t rtype, uint8_t req, uint8_t rid, uint8_t *buf) {</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">switch</span> (rtype) {</div>
<div class="line">    <span class="keywordflow">case</span> HID_REPORT_INPUT:</div>
<div class="line">      <span class="keywordflow">switch</span> (rid) {</div>
<div class="line">        <span class="keywordflow">case</span> 0:</div>
<div class="line">          <span class="keywordflow">switch</span> (req) {</div>
<div class="line">            <span class="keywordflow">case</span> <a class="code" href="group__status__error__codes__usb.html#gga4da684a1d01c75782fd63fcd65311791aa828fd6f941edb24dc3ec17e912c8745" title="request from control endpoint">USBD_HID_REQ_EP_CTRL</a>:        <span class="comment">// Explicit USB Host request via Control OUT Endpoint</span></div>
<div class="line">            <span class="keywordflow">case</span> <a class="code" href="group__status__error__codes__usb.html#gga4da684a1d01c75782fd63fcd65311791adde4a2cd8155113b82252ad237b899bf" title="request from periodic update">USBD_HID_REQ_PERIOD_UPDATE</a>:  <span class="comment">// Periodic USB Host request via Interrupt OUT Endpoint</span></div>
<div class="line">              <span class="comment">// ToDo: update buffer for report data, example:</span></div>
<div class="line">              <span class="comment">// buf[0] = 0;       // Data Value = 0</span></div>
<div class="line">              <span class="comment">// buf[1] = 5;       // Data Value = 5</span></div>
<div class="line">              <span class="comment">// return (2);       // Data Size  = 2 bytes</span></div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line">            </div>
<div class="line">            <span class="keywordflow">case</span> <a class="code" href="group__status__error__codes__usb.html#gga4da684a1d01c75782fd63fcd65311791a7d5c5fefca44e5d5b48bf0d2107f76ea" title="request from interrupt endpoint">USBD_HID_REQ_EP_INT</a>:         <span class="comment">// Called after USBD_HID_GetReportTrigger to signal</span></div>
<div class="line">                                              <span class="comment">// data obtained.</span></div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">      </div>
<div class="line">    <span class="keywordflow">case</span> HID_REPORT_FEATURE:</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// \brief Process received HID Report data.</span></div>
<div class="line"><span class="comment">// \param[in]   rtype   report type:</span></div>
<div class="line"><span class="comment">//                - HID_REPORT_OUTPUT    = output report received</span></div>
<div class="line"><span class="comment">//                - HID_REPORT_FEATURE   = feature report received</span></div>
<div class="line"><span class="comment">// \param[in]   req     request type:</span></div>
<div class="line"><span class="comment">//                - USBD_HID_REQ_EP_CTRL = report received on control endpoint</span></div>
<div class="line"><span class="comment">//                - USBD_HID_REQ_EP_INT  = report received on interrupt endpoint</span></div>
<div class="line"><span class="comment">// \param[in]   rid     report ID (0 if only one report exists).</span></div>
<div class="line"><span class="comment">// \param[in]   buf     buffer that receives report data.</span></div>
<div class="line"><span class="comment">// \param[in]   len     length of received report data.</span></div>
<div class="line"><span class="comment">// \return      true    received report data processed.</span></div>
<div class="line"><span class="comment">// \return      false   received report data not processed or request not supported.</span></div>
<div class="line"><span class="keywordtype">bool</span> <a class="code" href="group__usbd__hid_functions.html#gab7d101077f2018ca8a24da7dffce434f" title="Process received HID Report data.">USBD_HIDn_SetReport</a> (uint8_t rtype, uint8_t req, uint8_t rid, <span class="keyword">const</span> uint8_t *buf, int32_t len) {</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">switch</span> (rtype) {</div>
<div class="line">    <span class="keywordflow">case</span> HID_REPORT_OUTPUT:</div>
<div class="line">      <span class="comment">/*</span></div>
<div class="line"><span class="comment">        buf: Received Data</span></div>
<div class="line"><span class="comment">        len: Received Data Length</span></div>
<div class="line"><span class="comment">      */</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> HID_REPORT_FEATURE:</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
</div><!-- fragment --><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gafc3b0d68600cfbb390d1fa9b0ec8dac8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__status__error__codes__usb.html#gaa48e102b9b2600828158b5319c3386af">usbStatus</a> USBD_HID_GetReportTrigger </td>
          <td>(</td>
          <td class="paramtype">int8_t&#160;</td>
          <td class="paramname"><em>instance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>rid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Asynchronously prepare HID Report data to send. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">instance</td><td>instance of HID class. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rid</td><td>report ID. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">buf</td><td>buffer containing report data to send. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">len</td><td>number of report data bytes to send. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>status code that indicates the execution status of the function as defined with <a class="el" href="group__status__error__codes__usb.html#gaa48e102b9b2600828158b5319c3386af">usbStatus</a>.</dd></dl>
<p>The function <b>USBD_HID_GetReportTrigger</b> asynchronously prepares data that will be returned to the USB Host upon request. It enables the USB Device to send HID report data only when the data has changed. Usually, the USB Host sets idle time to <em>infinity</em> upon HID Device enumeration. This means, the USB Host expects data from a device only when it has changed. If idle time is not set to infinity, the <a class="el" href="group__usbd__hid_functions.html#gaed8b507a9ce1bf958fbcae55ee0b91bf">USBD_HIDn_GetReport</a> function is called whenever the idle time period is expired.</p>
<p>Use the function only for reports of type HID_REPORT_INPUT and for events that needs to update report data. The function should only be used for reports with the <em>rtype</em> = HID_REPORT_INPUT to signal that an updated HID report is available.</p>
<p>The argument <em>instance</em> specifies the instance of the HID device that is to be used.</p>
<p>The argument <em>rid</em> specifies the report ID and should be 0 if there's only one report in the system.</p>
<p>The argument <em>buf</em> is pointing to the buffer with the data to be sent.</p>
<p>The argument <em>len</em> specifies the number of bytes to be sent.</p>
<p><b>Code Example</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;cmsis_os.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;rl_usb.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Keyboard.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">void</span>) {</div>
<div class="line">  uint8_t but;</div>
<div class="line">  uint8_t buf[2];</div>
<div class="line"> </div>
<div class="line">  Keyboard_Initialize();</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="group__usbd__core_functions.html#ga559583d2070ad06bd6b7b5be76c8cd2f" title="Initialize USB Device stack and controller.">USBD_Initialize</a>    (0);  <span class="comment">/* USB Device 0 Initialization        */</span></div>
<div class="line">  <a class="code" href="group__usbd__core_functions.html#gae8cb53f9288fdf288ea368b63816b60d" title="Activate pull-up on D+ or D- line to signal USB Device connection on USB Bus.">USBD_Connect</a>       (0);  <span class="comment">/* USB Device 0 Connect               */</span></div>
<div class="line"> </div>
<div class="line">  <a class="code" href="group__usbd__core_functions.html#ga559583d2070ad06bd6b7b5be76c8cd2f" title="Initialize USB Device stack and controller.">USBD_Initialize</a>    (1);  <span class="comment">/* USB Device 1 Initialization        */</span></div>
<div class="line">  <a class="code" href="group__usbd__core_functions.html#gae8cb53f9288fdf288ea368b63816b60d" title="Activate pull-up on D+ or D- line to signal USB Device connection on USB Bus.">USBD_Connect</a>       (1);  <span class="comment">/* USB Device 1 Connect               */</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">while</span> (1) {              <span class="comment">/* Loop forever                       */</span></div>
<div class="line">    but = (uint8_t)(Keyboard_GetKeys ());</div>
<div class="line">    <span class="keywordflow">if</span> (((but     ) ^ buf[0]) &amp; 1) {</div>
<div class="line">      buf[0] = (but     ) &amp; 1;</div>
<div class="line">      <a class="code" href="group__usbd__hid_functions.html#gafc3b0d68600cfbb390d1fa9b0ec8dac8" title="Asynchronously prepare HID Report data to send.">USBD_HID_GetReportTrigger</a>(0, 0, &amp;buf[0], 1);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (((but &gt;&gt; 1) ^ buf[1]) &amp; 3) {</div>
<div class="line">      buf[1] = (but &gt;&gt; 1) &amp; 3;</div>
<div class="line">      <a class="code" href="group__usbd__hid_functions.html#gafc3b0d68600cfbb390d1fa9b0ec8dac8" title="Asynchronously prepare HID Report data to send.">USBD_HID_GetReportTrigger</a>(1, 0, &amp;buf[1], 1);</div>
<div class="line">    }</div>
<div class="line">    osDelay(100);          <span class="comment">/* 100 ms delay for sampling buttons  */</span></div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a class="anchor" id="gaed8b507a9ce1bf958fbcae55ee0b91bf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t USBD_HIDn_GetReport </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>rtype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>rid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>buf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepare HID Report data to send. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">rtype</td><td>report type:<ul>
<li>HID_REPORT_INPUT = input report requested</li>
<li>HID_REPORT_FEATURE = feature report requested </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">req</td><td>request type:<ul>
<li>USBD_HID_REQ_EP_CTRL = control endpoint request</li>
<li>USBD_HID_REQ_PERIOD_UPDATE = idle period expiration request</li>
<li>USBD_HID_REQ_EP_INT = previously sent report on interrupt endpoint request </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rid</td><td>report ID (0 if only one report exists). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">buf</td><td>buffer containing report data to send. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>number of report data bytes prepared to send or invalid report requested.<ul>
<li>value &gt;= 0: number of report data bytes prepared to send</li>
<li>value = -1: invalid report requested</li>
</ul>
</dd></dl>
<p>The function <b>USBD_HIDn_GetReport</b> prepares data that will be returned to the USB Host. You may modify the function to the application's needs. The function is called on any of the following events:</p>
<ul>
<li>after a <a class="el" href="group__usbd__hid_functions.html#gafc3b0d68600cfbb390d1fa9b0ec8dac8">USBD_HID_GetReportTrigger</a> was sent to the USB Host,</li>
<li>if HID report was requested by the USB Host through the control endpoint.</li>
</ul>
<p>The argument <em>rtype</em> specifies the report type: </p>
<table class="doxtable">
<tr>
<th>Value </th><th>Description </th></tr>
<tr>
<td>HID_REPORT_INPUT </td><td>Input report requested </td></tr>
<tr>
<td>HID_REPORT_FEATURE</td><td>Feature report requested </td></tr>
</table>
<p>The argument <em>req</em> specifies the request type: </p>
<table class="doxtable">
<tr>
<th>Value </th><th>Description </th></tr>
<tr>
<td>USBD_HID_REQ_EP_CTRL </td><td>Request came from control endpoint </td></tr>
<tr>
<td>USBD_HID_REQ_PERIOD_UPDATE</td><td>Request came from idle period expiration </td></tr>
<tr>
<td>USBD_HID_REQ_EP_INT </td><td>Request came from previously sent report on interrupt endpoint </td></tr>
</table>
<p>The argument <em>rid</em> specifies the report ID and should be 0 if there's only one report in the system.</p>
<p>The argument <em>buf</em> is pointing to the buffer to report data.</p>
<p><b>Code Example</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;rl_usbd.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;usb_hid.h&quot;</span></div>
<div class="line"> </div>
<div class="line">int32_t <a class="code" href="group__usbd__hid_functions.html#gaed8b507a9ce1bf958fbcae55ee0b91bf" title="Prepare HID Report data to send.">USBD_HIDn_GetReport</a> (uint8_t rtype, uint8_t req, uint8_t rid, uint8_t *buf) {</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (rtype) {</div>
<div class="line">    <span class="keywordflow">case</span> HID_REPORT_INPUT:</div>
<div class="line">      <span class="keywordflow">switch</span> (rid) {</div>
<div class="line">        <span class="keywordflow">case</span> 0:</div>
<div class="line">          <span class="keywordflow">switch</span> (req) {</div>
<div class="line">            <span class="keywordflow">case</span> <a class="code" href="group__status__error__codes__usb.html#gga4da684a1d01c75782fd63fcd65311791aa828fd6f941edb24dc3ec17e912c8745" title="request from control endpoint">USBD_HID_REQ_EP_CTRL</a>:</div>
<div class="line">            <span class="keywordflow">case</span> <a class="code" href="group__status__error__codes__usb.html#gga4da684a1d01c75782fd63fcd65311791adde4a2cd8155113b82252ad237b899bf" title="request from periodic update">USBD_HID_REQ_PERIOD_UPDATE</a>:</div>
<div class="line">            <span class="keywordflow">case</span> <a class="code" href="group__status__error__codes__usb.html#gga4da684a1d01c75782fd63fcd65311791a7d5c5fefca44e5d5b48bf0d2107f76ea" title="request from interrupt endpoint">USBD_HID_REQ_EP_INT</a>:</div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> HID_REPORT_FEATURE:</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a class="anchor" id="ga2c21f6f5bbe3b1fb832bbd7a1615f477"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBD_HIDn_Initialize </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called during <a class="el" href="group__usbd__core_functions.html#ga559583d2070ad06bd6b7b5be76c8cd2f">USBD_Initialize</a> to initialize the USB HID class Device. </p>
<dl class="section return"><dt>Returns</dt><dd>none.</dd></dl>
<p>The function <b>USBD_HIDn_Initialize</b> is called automatically upon initialization of a Human Interface Device Class Device and needs no invocation in the user code. Modify this function to the application needs to allocate resources and initialize additional peripherals.</p>
<p><b>Code Example</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;rl_usb.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;rl_usbd.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;usb_hid.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">void</span>)  {</div>
<div class="line">  ..</div>
<div class="line">  <a class="code" href="group__usbd__core_functions.html#ga559583d2070ad06bd6b7b5be76c8cd2f" title="Initialize USB Device stack and controller.">USBD_Initialize</a> (0);   <span class="comment">// USB Device 0 Initialization calls USBD_HIDn_Initialize() automatically</span></div>
<div class="line">  <a class="code" href="group__usbd__core_functions.html#gae8cb53f9288fdf288ea368b63816b60d" title="Activate pull-up on D+ or D- line to signal USB Device connection on USB Bus.">USBD_Connect</a> (0);      <span class="comment">// USB Device 0 Connect</span></div>
<div class="line">  ..</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a class="anchor" id="gab7d101077f2018ca8a24da7dffce434f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool USBD_HIDn_SetReport </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>rtype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>rid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Process received HID Report data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">rtype</td><td>report type:<ul>
<li>HID_REPORT_OUTPUT = output report received</li>
<li>HID_REPORT_FEATURE = feature report received </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">req</td><td>request type:<ul>
<li>USBD_HID_REQ_EP_CTRL = report received on control endpoint</li>
<li>USBD_HID_REQ_EP_INT = report received on interrupt endpoint </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rid</td><td>report ID (0 if only one report exists). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buf</td><td>buffer that receives report data. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">len</td><td>length of received report data. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true received report data processed. </dd>
<dd>
false received report data not processed or request not supported.</dd></dl>
<p>The function <b>USBD_HIDn_SetReport</b> handles HID report data that is received from the USB Host. The function is called when a HID report was received. You may modify the function to the application's needs.</p>
<p>The argument <em>rtype</em> specifies the report type: </p>
<table class="doxtable">
<tr>
<th>Value </th><th>Description </th></tr>
<tr>
<td>HID_REPORT_OUTPUT </td><td>Output report received </td></tr>
<tr>
<td>HID_REPORT_FEATURE</td><td>Feature report received </td></tr>
</table>
<p>The argument <em>req</em> specifies the request type: </p>
<table class="doxtable">
<tr>
<th>Value </th><th>Description </th></tr>
<tr>
<td>USBD_HID_REQ_EP_CTRL </td><td>Request came through control endpoint </td></tr>
<tr>
<td>USBD_HID_REQ_EP_INT </td><td>Request came through interrupt endpoint </td></tr>
</table>
<p>The argument <em>rid</em> specifies the report ID and should be 0 if there's only one report in the system.</p>
<p>The argument <em>buf</em> is pointing to the buffer to report data.</p>
<p>The argument <em>len</em> specifies the length of the received report data.</p>
<p><b>Code Example</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;rl_usbd.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;usb_hid.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> <a class="code" href="group__usbd__hid_functions.html#gab7d101077f2018ca8a24da7dffce434f" title="Process received HID Report data.">USBD_HIDn_SetReport</a> (uint8_t rtype, uint8_t req, uint8_t rid, <span class="keyword">const</span> uint8_t *buf, int32_t len) {</div>
<div class="line">  uint8_t i;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (rtype) {</div>
<div class="line">    <span class="keywordflow">case</span> HID_REPORT_OUTPUT:</div>
<div class="line">      <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (*buf &amp; (1 &lt;&lt; i))</div>
<div class="line">          LED_On  (i);</div>
<div class="line">        <span class="keywordflow">else</span> </div>
<div class="line">          LED_Off (i);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> HID_REPORT_FEATURE:</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a class="anchor" id="ga5ff95f579fd90e3c75f90c0c8d2b2968"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBD_HIDn_Uninitialize </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called during <a class="el" href="group__usbd__core_functions.html#ga462720e29daee5b88825566f313ac04e">USBD_Uninitialize</a> to un-initialize the USB HID class Device. </p>
<dl class="section return"><dt>Returns</dt><dd>none.</dd></dl>
<p>The function <b>USBD_HIDn_Uninitialize</b> is called automatically upon un-initialization of a Human Interface Device Class Device and needs no invocation in the user code. If <a class="el" href="group__usbd__hid_functions.html#ga2c21f6f5bbe3b1fb832bbd7a1615f477">USBD_HIDn_Initialize</a> has been adapted to the application, <b>USBD_HIDn_Uninitialize</b> should release resources and should de-initialize peripherals.</p>
<p><b>Code Example</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;rl_usb.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;rl_usbd.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;usb_hid.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">void</span>)  {</div>
<div class="line">  ..</div>
<div class="line">  <a class="code" href="group__usbd__core_functions.html#ga559583d2070ad06bd6b7b5be76c8cd2f" title="Initialize USB Device stack and controller.">USBD_Initialize</a> (0);         <span class="comment">// USB Device 0 Initialization</span></div>
<div class="line">  ...</div>
<div class="line">  <a class="code" href="group__usbd__core_functions.html#ga462720e29daee5b88825566f313ac04e" title="Un-initialize USB Device stack and controller.">USBD_Uninitialize</a> (0);       <span class="comment">// USB Device 0 Un-Initialization</span></div>
<div class="line">  ..</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Feb 20 2014 15:12:51 for USB Component by ARM Ltd. All rights reserved.
	<!--
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 
	-->
	</li>
  </ul>
</div>
</body>
</html>
