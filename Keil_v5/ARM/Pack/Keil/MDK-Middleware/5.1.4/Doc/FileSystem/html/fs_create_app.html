<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Create an Application Using the File System</title>
<title>File System Component: Create an Application Using the File System</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="drv.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylsheetf" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectlogo"><img alt="Logo" src="keilarm.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">File System Component
   &#160;<span id="projectnumber">Version 5.0</span>
   </div>
   <div id="projectbrief">MDK-Professional Middleware for Devices with Flash File System</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="DRVnav" class="tabs1">
    <ul class="tablist">
      <li id="GEN">   <a href="../../General/html/index.html"><span>General</span></a></li>
      <li id="FS"     class="current">    <a href="../../FileSystem/html/index.html"><span>File System</span></a></li>
      <li id="GRA">   <a href="../../Graphic/html/index.html"><span>Graphic</span></a></li>
      <li id="NET">   <a href="../../Network/html/index.html"><span>Network</span></a></li>
      <li id="USB">   <a href="../../USB/html/index.html"><span>USB</span></a></li>
    </ul>
</div>
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Usage&#160;and&#160;Description</span></a></li>
      <li><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('fs_create_app.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Create an Application Using the File System </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#fs_RTE_Software_Component_Selection">RTE Component Selection</a></li>
<li class="level1"><a href="#fs_Driver_Configuration">Necessary Drivers</a></li>
<li class="level1"><a href="#fs_Device_Configuration">File System Configuration</a></li>
<li class="level1"><a href="#fs_sys_req">System Resource Configuration</a></li>
<li class="level1"><a href="#fs_User_Code_Implementation">User Code Implementation</a></li>
</ul>
</div>
<div class="textblock"><p>The steps to create a microcontroller application that uses the File System are:</p>
<ol type="1">
<li>Select <a class="el" href="fs_create_app.html#fs_RTE_Software_Component_Selection">RTE Components</a> along with other components that are required for your application.</li>
<li><a class="el" href="fs_create_app.html#fs_Driver_Configuration">Enable necessary Drivers</a>.</li>
<li>Configure the various <a class="el" href="fs_create_app.html#fs_Device_Configuration">File System Components</a>.</li>
<li>Implement the <a class="el" href="fs_create_app.html#fs_User_Code_Implementation">User Code</a>.</li>
</ol>
<h1><a class="anchor" id="fs_RTE_Software_Component_Selection"></a>
RTE Component Selection</h1>
<p>Only a few steps are necessary to complete the RTE Component selection:</p>
<ol type="1">
<li>From the File System Component:<ul>
<li>Select <b>File System:CORE</b> that provides the basic functionality required for data storage and access. In the <b>Variant</b> drop-down box you can choose to use the SFN or LFN version.</li>
<li>Select your desired <b>File System:Drive</b>. For example, set <b>File System:Drive:Memory Card</b> to '1' for getting file access to an attached SD card.</li>
</ul>
</li>
<li>From the Drivers Component:<ul>
<li>Select appropriate drivers suitable for your application. For example, if you are using the Memory Card drive you need to select the MCI (and the SPI driver, if you intend to use the device in SPI mode). For Flash drives, you need to select the appropriate Flash driver. USB memory stick will be served selecting the USB driver.</li>
</ul>
</li>
<li>From the Device Component:<ul>
<li>Additional device specific drivers may be required according to the validation output.</li>
</ul>
</li>
<li>From the CMSIS Component:<ul>
<li>Select the <b>CMSIS:CORE</b> to provide the core interface to the processor.</li>
<li>Select a suitable <b>CMSIS:RTOS</b> that is a required for the File System Component.</li>
</ul>
</li>
</ol>
<div class="image">
<img src="fs_rte_comp_selection.png" alt="fs_rte_comp_selection.png"/>
<div class="caption">
RTE Component for File System</div></div>
<h1><a class="anchor" id="fs_Driver_Configuration"></a>
Necessary Drivers</h1>
<p>As the file system is not bound to a special type of hardware, you need to configure the necessary drivers according to the requirements of your target device. This configuration is done in the <b>RTE_Device.h</b> configuration file. Some devices require to have the DMA controller configured, while others need to have the SDIO driver selected. Please consult the device's user manual or hardware reference. Alternatively you may copy the setup of a File System example that is provided for various evaluation boards.</p>
<h1><a class="anchor" id="fs_Device_Configuration"></a>
File System Configuration</h1>
<h2>File System Core</h2>
<p>The File System Core configuration file <b>FS_Config.c</b> is listed in the Project Window under the Component File System and contains settings for the amount of files that can be open at the same time, the cache size for FAT names and for the cache buffer. Usually, the default settings will serve most of the applications. Changing the settings will affect the amount of memory that is used for the project.</p>
<h2>Drives</h2>
<p>The <b>Drive</b> configuration file <b>FS_Config_<em>Drive</em>_0.h</b> is also listed under the File System Component. It contains mostly drive specific settings, such as page and block sizes for Flash memories, general disk sizes for a RAM drive, and the hardware driver number for connecting the drive to the appropriate driver. Also, a file system cache can be enabled for non-Flash drives, <a class="el" href="fat_fs.html#journaling_fat">FAT journaling</a> can be selected and the <a class="el" href="fs_operation.html#def_sys_drive">default drive</a> may be set.</p>
<h1><a class="anchor" id="fs_sys_req"></a>
System Resource Configuration</h1>
<p>For proper operation, the File System Component requires some system configuration settings. The requirements are:</p>
<ul>
<li>Minimum <b>608 bytes heap size for each opened file</b>. If you want to be able to have three files open at the same time, you need to set a heap size of at least 3 * 608 = 1824 bytes. This can be configured in the device's <a href="http://www.keil.com/support/man/docs/gsac/gsac_startupcodecortex.htm" class="el" target="_blank">startup code</a> (<code>Heap_Size</code>).</li>
<li>As the File System Component is not creating any additional threads, you need to add <b>at least 1 kB </b> to the calling thread. This calling thread can be the main thread, a thread with a default stack size or a thread with a user provided stack size. Changing the size for these threads can be done in the <b>RTX_Conf_CM.c</b> file.</li>
</ul>
<h1><a class="anchor" id="fs_User_Code_Implementation"></a>
User Code Implementation</h1>
<p><a href="http://www.keil.com/support/man/docs/uv4/uv4_ca_sourcefiles.htm" class="el" target="_blank">User code template</a> files provide access to all functions that are required to use the File System Component. The available functions are explained in the <a href="./modules.html" class="el">Reference</a> section of the File System Component. These routines can be adapted to the needs of the microcontroller application, in case more functionality is needed. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Feb 20 2014 15:12:35 for File System Component by ARM Ltd. All rights reserved.
	<!--
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 
	-->
	</li>
  </ul>
</div>
</body>
</html>
