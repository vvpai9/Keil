<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Embedded File System</title>
<title>File System Component: Embedded File System</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="drv.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylsheetf" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectlogo"><img alt="Logo" src="keilarm.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">File System Component
   &#160;<span id="projectnumber">Version 5.0</span>
   </div>
   <div id="projectbrief">MDK-Professional Middleware for Devices with Flash File System</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="DRVnav" class="tabs1">
    <ul class="tablist">
      <li id="GEN">   <a href="../../General/html/index.html"><span>General</span></a></li>
      <li id="FS"     class="current">    <a href="../../FileSystem/html/index.html"><span>File System</span></a></li>
      <li id="GRA">   <a href="../../Graphic/html/index.html"><span>Graphic</span></a></li>
      <li id="NET">   <a href="../../Network/html/index.html"><span>Network</span></a></li>
      <li id="USB">   <a href="../../USB/html/index.html"><span>USB</span></a></li>
    </ul>
</div>
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Usage&#160;and&#160;Description</span></a></li>
      <li><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('emb_fs.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Embedded File System </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <b>Embedded File System (EFS)</b> is a proprietary file system used in the File System Component. Basic features are:</p>
<ul>
<li><a class="el" href="emb_fs.html#mem_org">Memory Organization</a> of the Flash Device is optimized for maximum performance.</li>
<li><a class="el" href="emb_fs.html#alloc_info">Allocation Information</a> is reduced to a minimum, allowing small data overhead.</li>
<li><a class="el" href="emb_fs.html#file_data_fragments">File Data Fragments</a> are of variable size and provide optimal file access times.</li>
</ul>
<h1><a class="anchor" id="mem_org"></a>
Memory Organization</h1>
<p>A Flash Device is divided into Flash <b>sectors</b>. Flash sectors are named <b>blocks</b> in the File System Component. Typically, a <b>block</b> is a 64 KB memory page. Blocks can be divided into memory cells, which are written sequentially. The memory cell size depends on the device architecture and is 8- (byte), 16- (half word) or 32-bit wide (word).</p>
<p>Each <b>block</b> contains its own <a class="el" href="emb_fs.html#alloc_info">allocation Information</a> written to the file allocation table located on top of the memory. The file name and file content are stored in lower memory regions. If the file size exceeds a single block, then the file is stored across several blocks. Several smaller files are stored into a single block.</p>
<div class="image">
<img src="fs_memoryorg.png" alt="fs_memoryorg.png"/>
<div class="caption">
Flash Memory Organization</div></div>
<p> When the file content is modified, the old file content is invalidated and a new memory block is allocated. The Flash block is erased when all the data stored in the Flash block have been invalidated.</p>
<h1><a class="anchor" id="alloc_info"></a>
Allocation Information</h1>
<p><b>Allocation Information</b> is stored at the top of a Flash block and is written in descending order. Each allocation information record consists of 8 bytes. Each file fragment has its own allocation record. The first file fragment starts in Flash block at offset 0. It is always assumed that the first file block starts at the beginning of a Flash block.</p>
<div class="image">
<img src="fs_allocinfo.png" alt="fs_allocinfo.png"/>
<div class="caption">
Flash Block Allocation</div></div>
<p> The file allocation information record has the following components:</p>
<ul>
<li><b>end</b> is the end address of the file fragment.</li>
<li><b>fileID</b> is the file identification number and is associated with the file name.</li>
<li><b>index</b> is the file fragment ordering number, which starts at 0 for each file.</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">struct </span>falloc {</div>
<div class="line">  uint32_t end;</div>
<div class="line">  uint16_t fileID;</div>
<div class="line">  uint16_t index;</div>
<div class="line">};</div>
</div><!-- fragment --><p>The file allocation information is written when:</p>
<ul>
<li>The file is opened for writing and the File System Core creates a filename information record.</li>
<li>The file is closed and the file handle released.</li>
<li>The file is flushed and the number of bytes from a file buffer is not a multiple of 4.</li>
<li>The Flash Block is full and there is no more free space.</li>
</ul>
<h1><a class="anchor" id="file_data_fragments"></a>
File Data Fragments</h1>
<p><b>File Data Fragments</b> are of <b>variable size</b> and are fully defined through the file allocation information record.</p>
<p>To make the best use of the Flash block, create <b>big file fragments</b> to reduce the total number of file fragments. It is not optimal to open a file for appending or writing a byte to it and close the file again. This approach creates huge file allocation information records, which consume 12 bytes of Flash in total; 8 bytes for the file allocation information and 4 bytes for the information. In addition, such an approach creates slow access times to files.</p>
<h1><a class="anchor" id="efs_limits"></a>
Limitations</h1>
<p>The following restrictions are applicable to the EFS:</p>
<ul>
<li>This file system is not compatible with the FAT file system and cannot be used with an USB mass storage device.</li>
<li>Directories or folders are not supported.</li>
<li>File names are preprocessed to remove the path information for non-FAT file systems.</li>
<li>Maximum file name length is limited to 31 characters.</li>
<li>Timestamp information is not supported for a file.</li>
<li>Drive partitions are not supported.</li>
<li>Search within files works only for files opened in read mode. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="fs_operation.html">Theory of Operation</a></li>
    <li class="footer">Generated on Thu Feb 20 2014 15:12:35 for File System Component by ARM Ltd. All rights reserved.
	<!--
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 
	-->
	</li>
  </ul>
</div>
</body>
</html>
