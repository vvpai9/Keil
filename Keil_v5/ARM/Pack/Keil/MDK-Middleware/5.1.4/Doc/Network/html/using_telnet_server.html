<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Telnet Server</title>
<title>Network Component: Telnet Server</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="drv.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylsheetf" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectlogo"><img alt="Logo" src="keilarm.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Network Component
   &#160;<span id="projectnumber">Version 5.0</span>
   </div>
   <div id="projectbrief">MDK-Professional Middleware for IP Networking</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="DRVnav" class="tabs1">
    <ul class="tablist">
      <li id="GEN">	  <a href="../../General/html/index.html"><span>General</span></a></li>
      <li id="FS">    <a href="../../FileSystem/html/index.html"><span>File System</span></a></li>
      <li id="GRA">   <a href="../../Graphic/html/index.html"><span>Graphic</span></a></li>
      <li id="NET"    class="current">  <a href="../../Network/html/index.html"><span>Network</span></a></li>
      <li id="USB">   <a href="../../USB/html/index.html"><span>USB</span></a></li>
    </ul>
</div>
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Usage&#160;and&#160;Description</span></a></li>
      <li><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('using_telnet_server.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Telnet Server </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>To enable a user to have access to a remote device, a command line interface needs to be in place on that device.</p>
<h1><a class="anchor" id="telnet_cli"></a>
Command Line Interface</h1>
<p>The Network Component's Telnet Server calls the <a class="el" href="group__net__tnet_func.html#ga595b62b7d994c87579f174c39c55a072">telnet_server_process</a> function when a command is received from the user. A command is any sequence of characters that is terminated by the CRLF sequence (the Enter key is pressed). The Telnet Server assembles this command and passes it as an argument to the <a class="el" href="group__net__tnet_func.html#ga595b62b7d994c87579f174c39c55a072">telnet_server_process</a> function.</p>
<p>The command line interface functions are located in the <b>Telnet_Server_UIF.c</b> template file. You must add this file to your project and customize it. You can add new commands or remove existing commands from the file. To add the template file to your project, simply right-click on the Source group, select <b>Add New Item to Group</b>, then click on <b>User Code Template</b> and scroll in the template files list until you find the <b>Telnet Server</b> template.</p>
<p>The following functions are implemented in this template file:</p>
<ul>
<li><a class="el" href="group__net__tnet_func.html#ga90a340a7cbf1951f9ab9ad1e076a25b9">telnet_server_message</a> - copies various system messages to the sending buffer for transmission to the Telnet Client. This function can also be used to support different languages.</li>
<li><a class="el" href="group__net__tnet_func.html#ga386068ea51b83a55a233812eb8a7961a">telnet_server_message_poll</a> - polls the upper-layer application for unsolicited messages.</li>
<li><a class="el" href="group__net__tnet_func.html#ga595b62b7d994c87579f174c39c55a072">telnet_server_process</a> - called by the Telnet Server to process the commands entered by a remote user and to generate a response.</li>
</ul>
<p>The following functions are included in the Network Component library rl_net.h:</p>
<ul>
<li><a class="el" href="group__net__tnet_func.html#gac75219986061fa29fbb89fa0d1d615a9">telnet_check_command</a> - compares the content of the command buffer.</li>
<li><a class="el" href="group__net__tnet_func.html#ga259d0edd6fcb2641cf275d691a9fb4ec">telnet_server_set_delay</a> - sets a delay before a repeated call to <a class="el" href="group__net__tnet_func.html#ga595b62b7d994c87579f174c39c55a072" title="Process and execute a command requested by the Telnet client.">telnet_server_process()</a>. You can use this function to implement a continuously updating screen.</li>
</ul>
<p><b>Code Example Telnet_Server_UIF.c</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="rl__net_8h.html">rl_net.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Request message for Telnet server session.</span></div>
<div class="line">uint32_t <a class="code" href="group__net__tnet_func.html#ga90a340a7cbf1951f9ab9ad1e076a25b9" title="Request message for Telnet server session.">telnet_server_message</a> (<a class="code" href="group__net__tnet_func.html#gaf2d30827862026f8fff321fad18cfdcb" title="Telnet Server Messages.">telnetServerMessage</a> msg, <span class="keywordtype">char</span> *buf, uint32_t len) {</div>
<div class="line">  uint32_t rlen = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (msg) {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="rl__net_8h.html#gaf2d30827862026f8fff321fad18cfdcba19285c802228d6e98dca830407cfcc59" title="Initial welcome message.">telnetServerWelcome</a>:</div>
<div class="line">      <span class="comment">// Initial welcome message</span></div>
<div class="line">      <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">      rlen = sprintf (buf, &quot;\r\n&quot;</span></div>
<div class="line"><span class="comment">                           &quot;\r\n&quot;</span></div>
<div class="line"><span class="comment">                           &quot;Telnet Server ready\r\n&quot;);</span></div>
<div class="line"><span class="comment">      */</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="rl__net_8h.html#gaf2d30827862026f8fff321fad18cfdcbafaf626d637acccd48864325f707f8e40" title="Prompt message.">telnetServerPrompt</a>:</div>
<div class="line">      <span class="comment">// Prompt message</span></div>
<div class="line">      <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">      rlen = sprintf (buf, &quot;\r\n&quot;</span></div>
<div class="line"><span class="comment">                           &quot;Cmd&gt; &quot;);</span></div>
<div class="line"><span class="comment">      */</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="rl__net_8h.html#gaf2d30827862026f8fff321fad18cfdcba4ef9054a1a565853ca64ddd49ac83dba" title="Login welcome message, if authentication is enabled.">telnetServerLogin</a>:</div>
<div class="line">      <span class="comment">// Login welcome message, if authentication is enabled</span></div>
<div class="line">      <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">      rlen = sprintf (buf, &quot;\r\n&quot;</span></div>
<div class="line"><span class="comment">                           &quot;Embedded Telnet Server\r\n&quot;</span></div>
<div class="line"><span class="comment">                           &quot;\r\n&quot;</span></div>
<div class="line"><span class="comment">                           &quot;Please login...&quot;);</span></div>
<div class="line"><span class="comment">      */</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="rl__net_8h.html#gaf2d30827862026f8fff321fad18cfdcbac14cc391eb8d40a26ea02c92296bd260" title="Username request login message.">telnetServerUsername</a>:</div>
<div class="line">      <span class="comment">// Username request login message</span></div>
<div class="line">      <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">      rlen = sprintf (buf, &quot;\r\n&quot;</span></div>
<div class="line"><span class="comment">                           &quot;Username: &quot;);</span></div>
<div class="line"><span class="comment">      */</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="rl__net_8h.html#gaf2d30827862026f8fff321fad18cfdcbad0d37d967f53f79a5fb61a0468f9df81" title="Password request login message.">telnetServerPassword</a>:</div>
<div class="line">      <span class="comment">// Password request login message</span></div>
<div class="line">      <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">      rlen = sprintf (buf, &quot;\r\n&quot;</span></div>
<div class="line"><span class="comment">                           &quot;Password: &quot;);</span></div>
<div class="line"><span class="comment">      */</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="rl__net_8h.html#gaf2d30827862026f8fff321fad18cfdcba26b8db0ded0d3181723cfb7878b7c10b" title="Incorrect login error message.">telnetServerLoginFailed</a>:</div>
<div class="line">      <span class="comment">// Incorrect login error message</span></div>
<div class="line">      <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">      rlen = sprintf (buf, &quot;\r\n&quot;</span></div>
<div class="line"><span class="comment">                           &quot;Login incorrect&quot;);</span></div>
<div class="line"><span class="comment">      */</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="rl__net_8h.html#gaf2d30827862026f8fff321fad18cfdcba1a4f296991a3bc322659fe50f6c95064" title="Login timeout error message.">telnetServerLoginTimeout</a>:</div>
<div class="line">      <span class="comment">// Login timeout error message</span></div>
<div class="line">      <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">      rlen = sprintf (buf, &quot;\r\n&quot;</span></div>
<div class="line"><span class="comment">                           &quot;Login timeout\r\n&quot;);</span></div>
<div class="line"><span class="comment">      */</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="rl__net_8h.html#gaf2d30827862026f8fff321fad18cfdcba448aadd7caf0c9e152377982ac94e077" title="Unsolicited message (ie. from basic interpreter)">telnetServerUnsolicitedMessage</a>:</div>
<div class="line">      <span class="comment">// Unsolicited message (ie. from basic interpreter)</span></div>
<div class="line">      <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">      rlen = sprintf (buf, &quot;\r\n&quot;</span></div>
<div class="line"><span class="comment">                           &quot;Unsolicited message\r\n&quot;);</span></div>
<div class="line"><span class="comment">      */</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> (rlen);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Poll the upper-layer user application for unsolicited messages.</span></div>
<div class="line"><span class="keywordtype">bool</span> <a class="code" href="group__net__tnet_func.html#ga386068ea51b83a55a233812eb8a7961a" title="Poll the upper-layer user application for unsolicited messages.">telnet_server_message_poll</a> (int32_t session) {</div>
<div class="line">  <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">  extern bool msg_available;</span></div>
<div class="line"><span class="comment"> </span></div>
<div class="line"><span class="comment">  if (session == 1 &amp;&amp; msg_available == true) {</span></div>
<div class="line"><span class="comment">    // Allow unsolicited messages on 1st session</span></div>
<div class="line"><span class="comment">    msg_available = false;</span></div>
<div class="line"><span class="comment">    return (true);</span></div>
<div class="line"><span class="comment">  }</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  <span class="keywordflow">return</span> (<span class="keyword">false</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Process a command and generate response.</span></div>
<div class="line">uint32_t <a class="code" href="group__net__tnet_func.html#ga595b62b7d994c87579f174c39c55a072" title="Process and execute a command requested by the Telnet client.">telnet_server_process</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *cmd, <span class="keywordtype">char</span> *buf, uint32_t buflen, uint32_t *pvar) {</div>
<div class="line">  uint32_t len = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">  extern int32_t AD_in (int32_t channel);</span></div>
<div class="line"><span class="comment"> </span></div>
<div class="line"><span class="comment">  if (telnet_check_command (cmd, &quot;ADIN0&quot;) == true) {</span></div>
<div class="line"><span class="comment">    // Read analog input 0</span></div>
<div class="line"><span class="comment">    len = sprintf (buf, &quot;\r\n&quot;</span></div>
<div class="line"><span class="comment">                        &quot; ADIN0 = %d&quot;, AD_in(0));</span></div>
<div class="line"><span class="comment">    return (len);</span></div>
<div class="line"><span class="comment">  }</span></div>
<div class="line"><span class="comment">  // ...</span></div>
<div class="line"><span class="comment">  if (telnet_check_command (cmd, &quot;BYE&quot;) == true) {</span></div>
<div class="line"><span class="comment">    // Generate reply and disconnect</span></div>
<div class="line"><span class="comment">    len = sprintf (buf, &quot;\r\n&quot;</span></div>
<div class="line"><span class="comment">                        &quot;Disconnecting\r\n&quot;);</span></div>
<div class="line"><span class="comment">    return (len | (1u&lt;&lt;30));</span></div>
<div class="line"><span class="comment">  }</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  <span class="keywordflow">return</span> (len);</div>
<div class="line">}</div>
</div><!-- fragment --> <h1><a class="anchor" id="telnet_access_filter"></a>
Access Filtering</h1>
<p>For access filtering the function <a class="el" href="group__net__tnet_func.html#ga0cd82707d3b57ed0bbb8d4c6905f2603">telnet_accept_client</a> is used. It is part of the file Telnet_Server_Access.c. You need to adapt the function to the application's needs.</p>
<p><b>Code Example Telnet_Server_Access.c</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="rl__net_8h.html">rl_net.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Accept or deny connection from remote Telnet client.</span></div>
<div class="line"><span class="comment">// If this function is missing, all remote clients are accepted.</span></div>
<div class="line"><span class="keywordtype">bool</span> <a class="code" href="group__net__tnet_func.html#ga0cd82707d3b57ed0bbb8d4c6905f2603" title="Accept or deny connection from remote Telnet client.">telnet_accept_client</a> (<span class="keyword">const</span> uint8_t *ip_addr, uint16_t port) {</div>
<div class="line">  <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">  if (ip_addr[0] == 192  &amp;&amp;</span></div>
<div class="line"><span class="comment">      ip_addr[1] == 168  &amp;&amp;</span></div>
<div class="line"><span class="comment">      ip_addr[2] == 0    &amp;&amp;</span></div>
<div class="line"><span class="comment">      ip_addr[3] == 1) {</span></div>
<div class="line"><span class="comment">    // Accept connection.</span></div>
<div class="line"><span class="comment">    return (true);</span></div>
<div class="line"><span class="comment">  }</span></div>
<div class="line"><span class="comment">  // Deny connection.</span></div>
<div class="line"><span class="comment">  return (false);</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  <span class="keywordflow">return</span> (<span class="keyword">true</span>);</div>
<div class="line">}</div>
</div><!-- fragment --> <h1><a class="anchor" id="multi_user_authentication"></a>
Multi-user Authentication</h1>
<p>The multi-user login allows you to create different profiles for different users or groups of users. The profiles define the access rights on the Telnet server. The users which are allowed to access the Telnet server are in the user database. The multi-user login allows you to selectively disable commands for unprivileged users.</p>
<p>If you want to use multi-user authentication, you must Enable User Authentication in the <b>Net_Config_Telnet_Server.h</b> configuration file.</p>
<p>The account defined in the <b>Net_Config_Telnet_Server.h</b> configuration file is a system administrator account, which has no restrictions. All other accounts are created in a separate <b>Telnet_Server_Multiuser.c</b> template file. You must add this file to your project and customize it. You can add new commands or remove existing commands from it. To add the template to your project, simply right-click on the Source group, select <b>Add Net Item to Group</b>, then click on <b>User Code Template</b> and scroll in the template files list until you find the <b>Telnet Server Multi-user</b> template (you will find a listing <a class="el" href="group__net__tnet_func.html#anchor_Telnet_Server_Multiuser">here</a>).</p>
<p>The following function is included in this template:</p>
<ul>
<li><a class="el" href="group__net__tnet_func.html#gac63ee3c10bc9434013d379b993ab5933">telnet_check_username</a> - checks if the provided user account exists.</li>
<li><a class="el" href="group__net__tnet_func.html#ga089c1c06e0033ab6a12629b9511ab3c3">telnet_check_password</a> - checks if the provided password is correct.</li>
</ul>
<p>The following function is included in the Network Component library rl_net.h:</p>
<ul>
<li><a class="el" href="group__net__tnet_func.html#ga5691f6f743acd673dd13557eaa22db2c">telnet_get_user_id</a> - retrieves the user identification number for the user, which is trying to access the file or folder.</li>
</ul>
<p><b>Code Example Telnet_Server_Multiuser.c</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="rl__net_8h.html">rl_net.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check if an user account exist in the user database.</span></div>
<div class="line">uint8_t <a class="code" href="group__net__tnet_func.html#gac63ee3c10bc9434013d379b993ab5933" title="Check if an user account exist in the user database.">telnet_check_username</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *username) {</div>
<div class="line">  <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">  if (strcmp (username, &quot;guest&quot;) == 0) {</span></div>
<div class="line"><span class="comment">    // Username is correct</span></div>
<div class="line"><span class="comment">    return (1);</span></div>
<div class="line"><span class="comment">  }</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check user account password in the user database.</span></div>
<div class="line"><span class="keywordtype">bool</span> <a class="code" href="group__net__tnet_func.html#ga089c1c06e0033ab6a12629b9511ab3c3" title="Check user account password in the user database.">telnet_check_password</a> (uint8_t user_id, <span class="keyword">const</span> <span class="keywordtype">char</span> *password) {</div>
<div class="line">  <span class="comment">/* Example</span></div>
<div class="line"><span class="comment">  if (user_id == 1) {</span></div>
<div class="line"><span class="comment">    if (strcmp (password, &quot;guest&quot;) == 0) {</span></div>
<div class="line"><span class="comment">      // Password is correct</span></div>
<div class="line"><span class="comment">      return (true);</span></div>
<div class="line"><span class="comment">    }</span></div>
<div class="line"><span class="comment">  }</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  <span class="keywordflow">return</span> (<span class="keyword">false</span>);</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd><ul>
<li>If the <b>Telnet_Server_Multiuser.c</b> is not added to the project, but authentication is enabled, the Telnet server runs in single user authentication mode.</li>
<li>You can disable a system administrator account, if you set an empty string as the <b>Authentication Username</b> .</li>
</ul>
</dd></dl>
<h1><a class="anchor" id="sending_telnet_reply"></a>
Example: Sending a Reply</h1>
<p>The <a class="el" href="group__net__tnet_func.html#ga595b62b7d994c87579f174c39c55a072">telnet_server_process</a> function processes the Telnet command when it is received from a remote client. This function then generates a reply message and sends it back to the user. It is part of the <b>Telnet_Server_UIF.c</b> template file.</p>
<p>When the reply message is short, the whole message can be sent in a <b>single TCP packet</b>. However, when long reports are generated, <b>multiple TCP packets</b> must be sent to transfer the whole message. For example, when the log files are displayed this is often the case. Both single and multiple packets are supported by the Embedded Telnet Server.</p>
<h2>Short Reply</h2>
<p>In the following example, the Telnet command HELP is sent by the Telnet client: </p>
<div class="fragment"><div class="line">cmd&gt; HELP</div>
</div><!-- fragment --><p> This command is answered by the predefined help message tnet_help. This message is copied to the output buffer and sent to the remote Telnet client. The following code sends the reply message: </p>
<div class="fragment"><div class="line">uint32_t <a class="code" href="group__net__tnet_func.html#ga595b62b7d994c87579f174c39c55a072" title="Process and execute a command requested by the Telnet client.">telnet_server_process</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *cmd, <span class="keywordtype">char</span> *buf, uint32_t buflen, uint32_t *pvar) {</div>
<div class="line">   ..</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__net__tnet_func.html#gac75219986061fa29fbb89fa0d1d615a9" title="Check command string for a command.">telnet_check_command</a> (cmd, <span class="stringliteral">&quot;HELP&quot;</span>) == <span class="keyword">true</span> || <a class="code" href="group__net__tnet_func.html#gac75219986061fa29fbb89fa0d1d615a9" title="Check command string for a command.">telnet_check_command</a> (cmd, <span class="stringliteral">&quot;?&quot;</span>) == <span class="keyword">true</span>) {</div>
<div class="line">    <span class="comment">// &#39;HELP&#39; command, display help text</span></div>
<div class="line">    len = sprintf (buf,tnet_help);</div>
<div class="line">    <span class="keywordflow">return</span> (len);</div>
<div class="line">  }</div>
<div class="line">   ..</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Long Reply</h2>
<p>A long reply message requires multiple calls to the function <a class="el" href="group__net__tnet_func.html#ga595b62b7d994c87579f174c39c55a072">telnet_server_process</a>. Each call to this function generates part of the reply message until the entire message is generated and sent. To distinguish between different calls to the function, the argument <em>pvar</em> is used. This argument is a pointer to a variable that is set to 0 on the first call and not altered on each subsequent call to this function. The function's return value, which specifies the number of bytes in the reply message, cannot exceed 1500. Hence the high bits of the function's return value is used to store the flags:</p>
<ul>
<li><b>Repeat flag</b> - bit 31 This flag tells the Telnet Server whether the function <a class="el" href="group__net__tnet_func.html#ga595b62b7d994c87579f174c39c55a072">telnet_server_process</a> must be called again or not (because the command processing is complete). The return value must be OR-ed with <span class="XML-Token">1u&lt;&lt;31</span> to call the function again.</li>
<li><b>Disconnect flag</b> - bit 30 This flag tells the Telnet Server to disconnect the Telnet connection. If this flag is set, the Telnet Server disconnects the current Telnet session. The return value must be OR-ed with <span class="XML-Token">0x8000</span> to disconnect.</li>
</ul>
<p>In the following example, the <b>MEAS</b> command is given by the user using the Telnet client. </p>
<div class="fragment"><div class="line">cmd&gt; MEAS</div>
</div><!-- fragment --><p> When a new Telnet command is received, the function <a class="el" href="group__net__tnet_func.html#ga595b62b7d994c87579f174c39c55a072">telnet_server_process</a> is called with the argument <em>pvar</em> set to 0. The command buffer <em>cmd</em> is checked to identify the command. </p>
<div class="fragment"><div class="line">uint32_t <a class="code" href="group__net__tnet_func.html#ga595b62b7d994c87579f174c39c55a072" title="Process and execute a command requested by the Telnet client.">telnet_server_process</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *cmd, <span class="keywordtype">char</span> *buf, uint32_t buflen, uint32_t *pvar) {</div>
<div class="line">  <a class="code" href="group__net__internal__system__functions.html#struct_t_c_p___i_n_f_o" title="TCP Socket info.">TCP_INFO</a> *tsoc;</div>
<div class="line">  uint32_t val,ch,temp;</div>
<div class="line">  uint32_t len = 0;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">switch</span> (MYBUF(pvar)-&gt;<span class="keywordtype">id</span>) {</div>
<div class="line">    <span class="keywordflow">case</span> 0:</div>
<div class="line">      <span class="comment">// First call to this function</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> 1:</div>
<div class="line">      <span class="comment">// Command MEAS, repeated call</span></div>
<div class="line">      ...</div>
<div class="line">      <span class="comment">// Set request for another callback</span></div>
<div class="line">      <span class="keywordflow">return</span> (len | 1u&lt;&lt;31);</div>
<div class="line">  ...</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Simple command line parser</span></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__net__tnet_func.html#gac75219986061fa29fbb89fa0d1d615a9" title="Check command string for a command.">telnet_check_command</a> (cmd, <span class="stringliteral">&quot;MEAS&quot;</span>) == <span class="keyword">true</span>) {</div>
<div class="line">    <span class="comment">// MEAS command given, monitor analog inputs</span></div>
<div class="line">    MYBUF(pvar)-&gt;id = 1;</div>
<div class="line">    <span class="keywordflow">if</span> (len &gt; 5) {</div>
<div class="line">      <span class="comment">// We must be careful here, because data is overlaid.</span></div>
<div class="line">      sscanf (&amp;cmd[5], <span class="stringliteral">&quot;%d&quot;</span>, &amp;temp);</div>
<div class="line">      MYBUF(pvar)-&gt;nmax = temp;</div>
<div class="line">    }</div>
<div class="line">    len = sprintf (buf, meas_header);</div>
<div class="line">    <span class="keywordflow">if</span> (MYBUF(pvar)-&gt;nmax) {</div>
<div class="line">      <span class="comment">// Bit 31 is a repeat flag.</span></div>
<div class="line">      len |= 1u&lt;&lt;31;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> (len);</div>
<div class="line">  }</div>
</div><!-- fragment --><p> When a command is recognized, you can reuse the same command buffer to store local variables, which might be needed in repeated calls. During the repeated call to this function, the <em>cmd</em> buffer is locked and is not altered by the system. You can use it as temporary storage of variables for the repeated calls. Each Telnet session has its own buffer of 96 bytes, of which only 95 bytes can be used.</p>
<p>The above example uses 3 bytes of a storage variable pointed by <em>pvar</em> pointer for the following structure: </p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">  uint8_t id;</div>
<div class="line">  uint8_t nmax;</div>
<div class="line">  uint8_t idx;</div>
<div class="line">} MY_BUF;</div>
<div class="line"><span class="preprocessor">#define MYBUF(p)        ((MY_BUF *)p)</span></div>
</div><!-- fragment --><p> When the call to <a class="el" href="group__net__tnet_func.html#ga595b62b7d994c87579f174c39c55a072">telnet_server_process</a> is repeated for the same command, the value of a storage variable pointed to by argument <em>pvar</em> is not altered any more. You can use the value of <em>pvar</em> to process the command differently. The <em>pvar</em> buffer now holds the private structure <code>MY_BUF</code>, which is valid for the lifetime of processing the command. When the command processing is finished, this buffer is not used any more until the next command. </p>
<div class="fragment"><div class="line">uint32_t <a class="code" href="group__net__tnet_func.html#ga595b62b7d994c87579f174c39c55a072" title="Process and execute a command requested by the Telnet client.">telnet_server_process</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *cmd, <span class="keywordtype">char</span> *buf, uint32_t buflen, uint32_t *pvar) {</div>
<div class="line">  <a class="code" href="group__net__internal__system__functions.html#struct_t_c_p___i_n_f_o" title="TCP Socket info.">TCP_INFO</a> *tsoc;</div>
<div class="line">  uint32_t val,ch,temp;</div>
<div class="line">  uint32_t len = 0;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">switch</span> (MYBUF(pvar)-&gt;<span class="keywordtype">id</span>) {</div>
<div class="line">    <span class="keywordflow">case</span> 0:</div>
<div class="line">      <span class="comment">// First call to this function</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> 1:</div>
<div class="line">      <span class="comment">// Command MEAS, repeated call</span></div>
<div class="line">      <span class="keywordflow">while</span> (len &lt; buflen-80) {</div>
<div class="line">        <span class="comment">// Let&#39;s use as much of the buffer as possible</span></div>
<div class="line">        len += sprintf (buf+len, <span class="stringliteral">&quot;\r\n%4d&quot;</span>, MYBUF(pvar)-&gt;idx);</div>
<div class="line">        <span class="keywordflow">for</span> (val = 0; val &lt; 8; val++) {</div>
<div class="line">          len += sprintf (buf+len, <span class="stringliteral">&quot;%7d&quot;</span>, AD_in(val));</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (++MYBUF(pvar)-&gt;idx &gt;= MYBUF(pvar)-&gt;nmax) {</div>
<div class="line">          <span class="comment">// Requested number of measurements done</span></div>
<div class="line">          <span class="keywordflow">return</span> (len);</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">// Set request for another callback</span></div>
<div class="line">      <span class="keywordflow">return</span> (len | 1u&lt;&lt;31);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> 2:</div>
<div class="line">      <span class="comment">// Repeated call, TCP status display</span></div>
<div class="line">      ...</div>
<div class="line">}</div>
</div><!-- fragment --><p> After giving a <code>meas</code> <code>4</code> command, the Telnet Client screen looks like this:</p>
<div class="image">
<img src="telnet_meas.png" alt="telnet_meas.png"/>
</div>
<dl class="section note"><dt>Note</dt><dd>You can check the <a class="el" href="_telnet__example.html">Telnet Server</a> to see how it works.</dd></dl>
<h1><a class="anchor" id="using_telnet_server_conf"></a>
Telnet Server Configuration</h1>
<div class="image">
<img src="net_config_telnet_server_h.png" alt="net_config_telnet_server_h.png"/>
<div class="caption">
Telnet Server Configuration File</div></div>
<p> The Telnet server configuration file <b>Net_Config_Telnet_Server.h</b> contains the following settings:</p>
<ul>
<li><b>Number of Telnet Sessions</b> specifies the number of available Telnet sessions. The default value is one, and this enables only one concurrent client connection. You should increase this number if multiple Telnet clients must connect to the Telnet server at the same time.</li>
<li><b>Port Number</b> specifies the listening TCP port number. The default Telnet server listening port is 23.</li>
<li><b>Idle Connection Timeout in seconds</b> specifies the interval of user inactivity, after which the connection is automatically closed. During an idle session, no TCP frames are exchanged. A value of 0 disables a disconnection on timeout.</li>
<li>The <b>Disable Echo</b> switch enables or disables the Telnet Server echo mode. When disabled, the Telnet Server will not echo characters it receives.</li>
<li>The <b>Enable User Authentication</b> switch enables or disables authentication with a username and a password.<ul>
<li><b>Authentication Realm</b> is the string which is displayed in the browser's authentication dialogue if an authentication is required. This is a zero terminated string.</li>
<li><b>Authentication Username</b> is the username for authentication.</li>
<li><b>Authentication Password</b> is the default password, that must be stored in non-volatile memory. The user can change the password later. </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="using_network_components.html">Using Network Components</a></li><li class="navelem"><a class="el" href="using_network_services.html">Services</a></li>
    <li class="footer">Generated on Thu Feb 20 2014 15:12:40 for Network Component by ARM Ltd. All rights reserved.
	<!--
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 
	-->
	</li>
  </ul>
</div>
</body>
</html>
